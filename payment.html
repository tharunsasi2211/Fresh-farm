<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Payment - Agro Mart</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 500px;
      margin: 20px auto;
      padding: 0 15px;
    }
    h1 {
      text-align: center;
      color: green;
    }
    form {
      margin-top: 20px;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      box-sizing: border-box;
      font-size: 1em;
    }
    button {
      background-color: green;
      color: white;
      border: none;
      cursor: pointer;
      margin-top: 15px;
    }
    button:hover {
      background-color: darkgreen;
    }
    label {
      display: inline-block;
      margin-top: 10px;
    }
    #cardFields, #cashFields {
      margin-top: 10px;
    }
    .invalid {
      border-color: red;
    }
    .error-msg {
      color: red;
      font-size: 0.9em;
      margin-top: 3px;
      margin-bottom: 10px;
    }
  </style>
  <script>
    function validateLetters(input) {
      const regex = /^[A-Za-z\s]+$/;
      return regex.test(input.trim());
    }

    function validatePhone(phone) {
      const regex = /^\d{10}$/;
      return regex.test(phone.trim());
    }

    function validateDigits(input) {
      const regex = /^\d+$/;
      return regex.test(input.trim());
    }

    function showError(input, msg) {
      let errorElem = input.nextElementSibling;
      if (!errorElem || !errorElem.classList.contains('error-msg')) {
        errorElem = document.createElement('div');
        errorElem.className = 'error-msg';
        input.parentNode.insertBefore(errorElem, input.nextSibling);
      }
      errorElem.textContent = msg;
      input.classList.add('invalid');
    }

    function clearError(input) {
      let errorElem = input.nextElementSibling;
      if (errorElem && errorElem.classList.contains('error-msg')) {
        errorElem.textContent = '';
      }
      input.classList.remove('invalid');
    }

    function validateForm(event) {
      let valid = true;
      const form = event.target;
      ['fullname', 'address', 'phone', 'amount'].forEach(name => {
        const input = form.querySelector(`input[name="${name}"]`);
        if (input) clearError(input);
      });

      const name = form.querySelector('input[name="fullname"]');
      const address = form.querySelector('input[name="address"]');
      const phone = form.querySelector('input[name="phone"]');
      const amount = form.querySelector('input[name="amount"]');

      if (!validateLetters(name.value)) {
        showError(name, 'Invalid name. Use letters only.');
        valid = false;
      }
      if (!validateLetters(address.value)) {
        showError(address, 'Invalid address. Use letters only.');
        valid = false;
      }
      if (!validatePhone(phone.value)) {
        showError(phone, 'Phone must be exactly 10 digits.');
        valid = false;
      }
      if (!validateDigits(amount.value)) {
        showError(amount, 'Amount should be digits only.');
        valid = false;
      }

      // Payment method specific validations
      const paymentMethod = form.querySelector('input[name="paymentMethod"]:checked').value;
      if (paymentMethod === 'card') {
        const cardNo = form.querySelector('input[name="cardNumber"]');
        const cvv = form.querySelector('input[name="cvv"]');
        if (!validateDigits(cardNo.value) || cardNo.value.length !== 16) {
          showError(cardNo, 'Card number must be exactly 16 digits.');
          valid = false;
        }
        if (!validateDigits(cvv.value) || (cvv.value.length !== 3 && cvv.value.length !== 4)) {
          showError(cvv, 'CVV must be 3 or 4 digits.');
          valid = false;
        }
      }

      if (!valid) {
        event.preventDefault();
      }
    }

    function togglePaymentFields() {
      const method = document.querySelector('input[name="paymentMethod"]:checked').value;
      document.getElementById('cardFields').style.display = (method === 'card') ? 'block' : 'none';
      document.getElementById('cashFields').style.display = (method === 'cash') ? 'block' : 'none';
    }

    window.onload = () => {
      // Load total amount from session storage
      const total = sessionStorage.getItem('totalAmount') || '0';
      document.getElementById('amount').value = total;

      // Set payment fields visibility
      togglePaymentFields();

      // Attach event to payment method radios
      document.querySelectorAll('input[name="paymentMethod"]').forEach(radio => {
        radio.addEventListener('change', togglePaymentFields);
      });
    };
  </script>
</head>
<body>
  <h1>Payment</h1>
  <form onsubmit="validateForm(event)" novalidate action="thankyou.html" method="post">
    <input type="text" name="fullname" placeholder="Full Name" required />
    <input type="text" name="address" placeholder="Address" required />
    <input type="text" name="phone" placeholder="Phone Number (10 digits)" required />
    <input type="text" id="amount" name="amount" placeholder="Amount" readonly />

    <label>
      <input type="radio" name="paymentMethod" value="card" checked /> Card Payment
    </label>
    <label>
      <input type="radio" name="paymentMethod" value="cash" /> Cash on Delivery
    </label>

    <div id="cardFields">
      <input type="text" name="cardNumber" placeholder="Card Number (16 digits)" maxlength="16" />
      <input type="text" name="cvv" placeholder="CVV (3 or 4 digits)" maxlength="4" />
    </div>

    <div id="cashFields" style="display:none; padding:10px; background:#f0fff0; margin-top:10px;">
      <p>You have chosen Cash on Delivery. Please keep the exact amount ready.</p>
    </div>

    <button type="submit">Pay Now</button>
  </form>
</body>
</html>
